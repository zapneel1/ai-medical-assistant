/*! For license information please see responses.editor.5a11f4da.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunklite=self.webpackChunklite||[]).push([[5258],{15279:(e,t,n)=>{n.r(t),n.d(t,{ThreadedInlineResponseEditor:()=>Q});var r=n(82284),o=n(80296),i=n(96540),a=n(74793),u=n(70694),l=n(43389),c=n(88615),s=n(99836),p=n(10467),d=n(64467),f=n(17180),h=n(8389),y=n(82487),m=n(60602),v=n(78265),g=n(41281),b=n(45458);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,d.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var O,S=n(98023),x=n.n(S),N=n(95420),I=n(72130),j=n(49287),L=n(92571),P={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"updatePostResponse"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"responseId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"latestRev"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"deltas"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Delta"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updatePostResponse"},arguments:[{kind:"Argument",name:{kind:"Name",value:"responseId"},value:{kind:"Variable",name:{kind:"Name",value:"responseId"}}},{kind:"Argument",name:{kind:"Name",value:"latestRev"},value:{kind:"Variable",name:{kind:"Name",value:"latestRev"}}},{kind:"Argument",name:{kind:"Name",value:"deltas"},value:{kind:"Variable",name:{kind:"Name",value:"deltas"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"itemType"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"StreamItemPostSimpleResponse"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"post"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SimpleResponse_post"}}]}}]}}]}}]}}]}}].concat((0,b.A)(L.Nx.definitions))};!function(e){e.success="SUCCESS",e.error="ERROR"}(O||(O={}));var R=function(e){var t;return(t={},(0,d.A)(t,O.success,"inlineEditor.publish"),(0,d.A)(t,O.error,"inlineEditor.publishError"),t)[e]},A=n(79756);function T(){T=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},u=a.iterator||"@@iterator",l=a.asyncIterator||"@@asyncIterator",c=a.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),u=new R(r||[]);return i(a,"_invoke",{value:I(e,n,u)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=p;var f="suspendedStart",h="suspendedYield",y="executing",m="completed",v={};function g(){}function b(){}function k(){}var w={};s(w,u,(function(){return this}));var E=Object.getPrototypeOf,O=E&&E(E(A([])));O&&O!==n&&o.call(O,u)&&(w=O);var S=k.prototype=g.prototype=Object.create(w);function x(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function N(e,t){function n(i,a,u,l){var c=d(e[i],e,a);if("throw"!==c.type){var s=c.arg,p=s.value;return p&&"object"==(0,r.A)(p)&&o.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,u,l)}),(function(e){n("throw",e,u,l)})):t.resolve(p).then((function(e){s.value=e,u(s)}),(function(e){return n("throw",e,u,l)}))}l(c.arg)}var a;i(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}})}function I(t,n,r){var o=f;return function(i,a){if(o===y)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:e,done:!0}}for(r.method=i,r.arg=a;;){var u=r.delegate;if(u){var l=j(u,r);if(l){if(l===v)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=y;var c=d(t,n,r);if("normal"===c.type){if(o=r.done?m:h,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=m,r.method="throw",r.arg=c.arg)}}}function j(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,j(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var i=d(o,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function A(t){if(t||""===t){var n=t[u];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){for(;++i<t.length;)if(o.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError((0,r.A)(t)+" is not iterable")}return b.prototype=k,i(S,"constructor",{value:k,configurable:!0}),i(k,"constructor",{value:b,configurable:!0}),b.displayName=s(k,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,s(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},x(N.prototype),s(N.prototype,l,(function(){return this})),t.AsyncIterator=N,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new N(p(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},x(S),s(S,c,"Generator"),s(S,u,(function(){return this})),s(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=A,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return u.type="throw",u.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],u=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:A(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){(0,d.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _=function(e){var t=e.responseId,n=e.parentEntityId,r=e.parentEntityTypename,a=e.initialValue,u=e.showEditorHeader,c=void 0===u||u,d=(0,j.jI)(),k=(0,I.$L)(),S=i.useContext(y.o),L=S.setIsEditing,D=S.createdAt,_=S.editingQuote,V=S.setEditingQuote,F=i.useContext(l.o),G=F.setIsSavingResponse,B=F.rootEntityId,M=F.rootEntityTypename,H=i.useContext(m.a).threadDepthFromRootEntity,z=function(e){var t=e.responseId,n=(0,I.$L)(),r=(0,j.jI)(),a=i.useContext(y.o).latestRev,u=(0,N.n)(P,{variables:{responseId:t,latestRev:-1,deltas:[]},onError:function(){n.event(R(O.error),{responseId:t,source:r})},update:function(){n.event(R(O.success),{responseId:t,source:r})}}),l=(0,o.A)(u,2),c=l[0],s=l[1];return{updateResponse:i.useCallback((function(e){return c({variables:{latestRev:x()(a)?a:-1,deltas:e,responseId:t}})}),[c,t,a]),error:null==s?void 0:s.error,loading:null==s?void 0:s.loading}}({responseId:t}),Q=z.updateResponse,Y=z.error,U=z.loading,$=i.useRef(null);i.useEffect((function(){var e;null!=$&&null!==(e=$.current)&&void 0!==e&&e.getBoundingClientRect&&$.current.getBoundingClientRect().bottom>window.innerHeight&&$.current.scrollIntoView({behavior:"smooth",block:"end"})}),[]);var J=i.useCallback((function(e,o){var i=e.map((function(e){return e.paragraph&&!e.paragraph.markups?C(C({},e),{},{paragraph:C(C({},e.paragraph),{},{markups:[]})}):e})),u=function(e){var t,n,r=e.originalParagraphs,o=void 0===r?[]:r,i=e.newDeltas,a=void 0===i?[]:i,u=(0,b.A)(a),l=o.map((function(e,t){return{name:e.name,markups:e.markups,index:t}})),c=a.map((function(e){var t;return null==e||null===(t=e.paragraph)||void 0===t?void 0:t.name})),s=0,p=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}(null==l?void 0:l.filter((function(e){return!c.includes(e.name)})));try{for(p.s();!(n=p.n()).done;){var d=n.value;(!t||d.index<t)&&(t=d.index),u.splice(d.index,0,{index:d.index-s,type:2,paragraph:{name:d.name,markups:d.markups},verifySameName:!1}),s+=1}}catch(e){p.e(e)}finally{p.f()}return l.forEach((function(e){var t=e.name,n=e.index,r=u.findIndex((function(e){var n;return(null==e||null===(n=e.paragraph)||void 0===n?void 0:n.name)===t}));void 0!==r&&void 0!==u[r]&&u[r].index!==n&&2!==u[r].type&&(u[r]=w(w({},u[r]),{},{verifySameName:!1}))})),u}({originalParagraphs:null==a?void 0:a.paragraphs,newDeltas:i});G(!0),Q(u).then((function(){L(!1),G(!1),k.event("response.edited",C(C(C({postId:t},(0,A.rz)(n,r)),(0,A.DL)(B,M)),{},{threadDepth:H,context:h.J.INLINE_POST_RESPONSE,source:d})),o()})).catch((function(){G(!1)}))}),[Q]);return(0,f.Ox)(Y)?i.createElement(s.x,{message:(0,A.it)(M)}):i.createElement("div",{ref:$},i.createElement(g.d,{isPublishingResponse:U,publishResponse:J,type:v.o.edit,createdAt:D,onClose:(0,p.A)(T().mark((function e(){return T().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return G(!1),L(!1),V(null),e.abrupt("return",{preventStateUpdate:!0});case 4:case"end":return e.stop()}}),e)}))),inResponseToQuote:_,initialValue:a,showEditorHeader:c}))},V=n(58168),F=n(60301),G=n(52290),B=n(36557),M=function(e){var t=e.entityId,n=e.entitySlug,r=e.entityTypename,o=e.entityCreatorName,a=(0,A.bY)(r),u={};return"Post"===r&&(u={postId:t}),"Catalog"===r&&(u={username:o,catalogSlugId:n}),i.createElement(G.a,{backgroundColor:"BASE_NORMAL",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:"24px"},i.createElement(B.kZ,{scale:"S",color:"DARKER"},"To respond",a?" to this ".concat(a):"",",",i.createElement("br",null),"get the free Medium app."),i.createElement(G.a,null,i.createElement(F.z,(0,V.A)({isButton:!0,buttonSize:"SMALL",appEntry:"responsesSidebar"},u))))},H=n(44402),z=n(65550),Q=function(e){var t=e.parentEntityId,n=e.parentEntityTypename,p=e.parentCreatorName,d=e.parentEntitySlug,f=e.responseId,h=e.type,y=e.initialValue,m=e.viewerPronouns,g=e.editorOpenByDefault,b=void 0!==g&&g,k=e.autofocus,w=e.scrollIntoView,E=e.showPublishCheckbox,O=(0,i.useContext)(l.o),S=O.responsesLocked,x=O.isLockedResponse,N=O.rootEntityTypename,I=(0,i.useState)(!1),L=(0,o.A)(I,2),P=L[0],R=L[1],T=(0,H.l)(),D=h===v.o.edit,C=(0,z.L)(),V=(0,i.useMemo)((function(){if(D&&y)return(0,u.RJ)(y)}),[D,y]);if((0,i.useEffect)((function(){void 0!==("undefined"==typeof document?"undefined":(0,r.A)(document))&&R(!0)}),[]),!P)return null;if(S){var F=(0,A.bY)(N),G=x&&F?"This response belongs to ".concat(F?"a ".concat(F," with "):"","a closed discussion. Responding is not supported at this time."):void 0;return i.createElement(s.x,{message:G})}return C?i.createElement(M,{entitySlug:d,entityId:t,entityTypename:n,entityCreatorName:p}):i.createElement(j.Ne,{source:{susiEntry:(0,A.gz)(n)},extendSource:!0},i.createElement(a.jG,{initialValue:V,localStorageId:f||t},D&&f?i.createElement(B.kZ,{scale:"M",color:"DARKER",tag:"div"},i.createElement("div",{className:T({lineHeight:"24px"})},i.createElement(_,{responseId:f,parentEntityId:t,parentEntityTypename:n,initialValue:y,showEditorHeader:!1}))):i.createElement(c.Q,{parentEntityId:t,parentEntityTypename:n,editorOpenByDefault:b,viewerPronouns:m,autofocus:k,scrollIntoView:w,showPublishCheckbox:E})))}}}]);
//# sourceMappingURL=https://stats.medium.build/lite/sourcemaps/responses.editor.5a11f4da.chunk.js.map